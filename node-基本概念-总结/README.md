# node的特点

## 非阻塞I/O  

例如，在传统的单线程处理机制中，当访问数据库代码之后，整个线程都将暂停下来，等待数据库返回结果，才能执行后面的代码，也就是说`I/O阻塞了代码的执行，降低了程序的运行效率`。

由于node中采用了非阻塞I/O机制，因此在访问了数据库之后，将立即执行其后面的代码，将数据库返回结果的处理代码放到回调函数当中，从而提高了程序的运行效率。

当某个I/O执行完毕时，将以事件的形式通知执行I/O操作的线程(javascript线程)， 线程执行这个事件的回调函数。为了处理异步I/O，主线程必须有`事件循环`，不断的检查有没有未处理的事件，依次予以处理。

## 事件循环

在进程启动时，node便会创建一个类似于while(true)的循环，每执行一次循环体的过程我们称之为*Tick*。每个Tick的过程就是查看是否有事件待处理，如果有，就取出事件及相关的回调函数并执行它们。然后进入下一个循环（Tick）。如果不再有时间处理，就退出进程。

<img src="https://github.com/JianpanBucuo/node_package/blob/master/node-基本概念/event_circle.png" width="456" height="484"/>

## 单线程

我们经常提到node是单线程的

这里的单线程仅仅只是Javascript执行在单线程中，除了这部分以外，很多部分都是多线程的

I/O操作实际上是交给libuv来做的，而libuv提供了完整的线程池，所以I/O操作都是可以并行的

<img src="https://github.com/JianpanBucuo/node_package/blob/master/node-基本概念/component.png" width="395" height="368"/>


## Node的优势/缺点

### 单线程的优势/缺点

优势

1. 利用单线程，远离多线程死锁，状态同步等问题
2. 没有线程上下文交换所带来的性能上的开销
3. 利用异步I/O，让单线程远离阻塞，以更好的提高CPU利用率

`node以事件驱动的方式处理请求，无须为每一个请求创建额外的对应线程，可以省掉创建线程和销毁线程的开销，同时操作系统在调度任务时因为线程较少，上下文切换的代价很低，这使得服务器可以有条不紊的处理请求`
缺点

1. 无法利用多核CPU
2. 错误会引起整个应用退出，应用的健壮性值得考虑
3. 大量计算占用CPU导致无法继续调用异步I/O

`Javascript长时间的执行会导致后续的异步I/O发不出调用，已完成的异步I/O的回调函数也会得不到及时执行`

## node的应用场景

### I/O密集型

node擅长`I/O密集型`的应用场景，node面向网络且擅长并行I/O，能够有效的组织起更多的硬件资源。

`I/O密集的优势主要在于Node利用事件循环的处理能力，而不是启动每一个线程为每一个请求服务，资源占用较少`

### CPU密集型

由于Javascript单线程的原因，如果有长时间的运算（大循环），将会导致CPU时间片不能释放，使得后续I/O无法发起。可以适当调整和分解大型运算任务为多个小任务，使得运算能够适时释放，不阻塞I/O调用的发起，这样既可同时享受到并行I/O的好处，又能充分利用CPU

`对于长时间的计算，如果它的耗时超过普通阻塞I/O的耗时，那么应用场景就需要重新评估，因为这类计算比阻塞I/O还影响效率，甚至说是一个纯计算的场景。此类应用场景应当采用多线程的方式进行计算。`


